{
  "version": 3,
  "sources": ["../../@dytesdk/ui-kit/dist/esm/dyte-participants-audio.entry.js"],
  "sourcesContent": ["import { r as registerInstance, c as createEvent, h, H as Host } from './index-08f4416b.js';\nimport { e as disableSettingSinkId, a as defaultIconPack, c as useLanguage, v as isLiveStreamViewer } from './ui-store-9dd5dd86.js';\nimport { l as logger } from './logger-31448943.js';\nimport { S as SyncWithStore } from './index-39fa23f1.js';\n\n/**\n * Handles audio from participants in a meeting\n */\nclass DyteAudio {\n    constructor(meeting, audio) {\n        this.meeting = meeting;\n        this.audio = audio !== null && audio !== void 0 ? audio : document.createElement('audio');\n        this.audio.autoplay = true;\n        this.audioStream = new MediaStream();\n        this.audio.srcObject = this.audioStream;\n        this.audioTracks = [];\n    }\n    addTrack(id, track) {\n        if (!this.audioTracks.some((a) => a.id === id)) {\n            this.audioTracks.push({ id, track });\n            this.audioStream.addTrack(track);\n            this.play();\n        }\n    }\n    removeTrack(id) {\n        const track = this.audioTracks.find((a) => a.id === id);\n        if (track != null) {\n            this.audioStream.removeTrack(track.track);\n            this.audioTracks = this.audioTracks.filter((a) => a.id !== id);\n        }\n    }\n    async play() {\n        var _a;\n        this.audio.srcObject = this.audioStream;\n        await ((_a = this.audio.play()) === null || _a === void 0 ? void 0 : _a.catch((err) => {\n            if (err.name === 'NotAllowedError') {\n                if (this._onError != null) {\n                    this._onError();\n                }\n            }\n            else if (err.name !== 'AbortError') {\n                logger.error('[dyte-audio] play() error\\n', err);\n            }\n        }));\n    }\n    async setDevice(id) {\n        var _a, _b, _c;\n        if (disableSettingSinkId(this.meeting))\n            return;\n        await ((_c = (_b = (_a = this.audio).setSinkId) === null || _b === void 0 ? void 0 : _b.call(_a, id)) === null || _c === void 0 ? void 0 : _c.catch((err) => {\n            logger.error('[dyte-audio] setSinkId() error\\n', err);\n        }));\n    }\n    onError(onError) {\n        this._onError = onError;\n    }\n}\n\nconst dyteParticipantsAudioCss = \":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block;overflow-wrap:break-word;color:rgb(var(--dyte-colors-text-1000, 255 255 255));word-wrap:break-word}.modal{box-sizing:border-box;width:100%;max-width:var(--dyte-space-96, 384px);padding:var(--dyte-space-4, 16px);border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.modal h3{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px);font-size:24px;font-weight:500}.modal p{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-6, 24px)}.modal dyte-button{width:100%}\";\nconst DyteParticipantsAudioStyle0 = dyteParticipantsAudioCss;\n\nvar __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\")\n        r = Reflect.decorate(decorators, target, key, desc);\n    else\n        for (var i = decorators.length - 1; i >= 0; i--)\n            if (d = decorators[i])\n                r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nconst DyteParticipantsAudio = class {\n    constructor(hostRef) {\n        registerInstance(this, hostRef);\n        this.dialogClose = createEvent(this, \"dialogClose\", 7);\n        /** Icon pack */\n        this.iconPack = defaultIconPack;\n        /** Language */\n        this.t = useLanguage();\n        /** Pass existing audio element */\n        this.preloadedAudioElem = undefined;\n        this.showPlayDialog = false;\n        this.onDyteDialogClose = () => {\n            this.showPlayDialog = false;\n            this.dialogClose.emit();\n        };\n    }\n    componentDidLoad() {\n        this.meetingChanged(this.meeting);\n    }\n    disconnectedCallback() {\n        var _a;\n        if (this.meeting == null)\n            return;\n        this.audioUpdateListener &&\n            this.meeting.participants.joined.removeListener('audioUpdate', this.audioUpdateListener);\n        this.screenShareUpdateListener &&\n            this.meeting.participants.joined.removeListener('screenShareUpdate', this.screenShareUpdateListener);\n        this.participantLeftListener &&\n            this.meeting.participants.joined.removeListener('participantLeft', this.participantLeftListener);\n        this.deviceUpdateListener &&\n            this.meeting.self.removeListener('deviceUpdate', this.deviceUpdateListener);\n        this.stageStatusUpdateListener &&\n            ((_a = this.meeting.stage) === null || _a === void 0 ? void 0 : _a.removeListener('stageStatusUpdate', this.stageStatusUpdateListener));\n    }\n    async setupAudio() {\n        this.audio = new DyteAudio(this.meeting, this.preloadedAudioElem);\n        // Set the device to the current speaker device\n        const currentDevices = this.meeting.self.getCurrentDevices();\n        if (currentDevices.speaker != null) {\n            await this.audio.setDevice(currentDevices.speaker.deviceId);\n        }\n    }\n    async handleAutoPlayError() {\n        if (!this.audio) {\n            await this.setupAudio();\n        }\n        this.audio.onError(() => {\n            this.showPlayDialog = true;\n        });\n        this.audio.play();\n        return;\n    }\n    async handleEvents(meeting) {\n        this.audioUpdateListener = ({ id, audioEnabled, audioTrack }) => {\n            const audioId = `audio-${id}`;\n            if (audioEnabled && audioTrack != null) {\n                this.audio.addTrack(audioId, audioTrack);\n            }\n            else {\n                this.audio.removeTrack(audioId);\n            }\n        };\n        const participants = meeting.participants.joined.toArray();\n        for (const participant of participants) {\n            this.audioUpdateListener(participant);\n        }\n        this.participantLeftListener = ({ id }) => {\n            this.audio.removeTrack(`audio-${id}`);\n            this.audio.removeTrack(`screenshare-${id}`);\n        };\n        this.screenShareUpdateListener = ({ id, screenShareEnabled, screenShareTracks }) => {\n            const audioId = `screenshare-${id}`;\n            if (screenShareEnabled && screenShareTracks.audio != null) {\n                this.audio.addTrack(audioId, screenShareTracks.audio);\n            }\n            else {\n                this.audio.removeTrack(audioId);\n            }\n        };\n        this.deviceUpdateListener = ({ device, preview }) => {\n            if (preview)\n                return;\n            if (device.kind === 'audiooutput') {\n                this.audio.setDevice(device.deviceId);\n            }\n        };\n        meeting.participants.joined.addListener('audioUpdate', this.audioUpdateListener);\n        meeting.participants.joined.addListener('screenShareUpdate', this.screenShareUpdateListener);\n        meeting.participants.joined.addListener('participantLeft', this.participantLeftListener);\n        meeting.self.addListener('deviceUpdate', this.deviceUpdateListener);\n    }\n    async meetingChanged(meeting) {\n        var _a;\n        if (meeting == null)\n            return;\n        this.setupAudio();\n        if (isLiveStreamViewer(meeting)) {\n            this.stageStatusUpdateListener = async (status) => {\n                if (status === 'ON_STAGE') {\n                    // NOTE(@madhugb): When someone joins stage handle autoplay and also handle events\n                    await this.handleAutoPlayError();\n                }\n            };\n            (_a = meeting.stage) === null || _a === void 0 ? void 0 : _a.on('stageStatusUpdate', this.stageStatusUpdateListener);\n        }\n        else {\n            await this.handleAutoPlayError();\n        }\n        await this.handleEvents(meeting);\n    }\n    render() {\n        return (h(Host, { key: '8f75e172807ecedd630de70b5cc3e8c73aad09de' }, this.showPlayDialog && (h(\"dyte-dialog\", { key: '4770efe5ed393e2033706e983996a2b7f822feac', open: true, onDyteDialogClose: this.onDyteDialogClose, hideCloseButton: true, disableEscapeKey: true, iconPack: this.iconPack, t: this.t }, h(\"div\", { key: '5c1cb440b28b8a7a3e655056a3495f1d10c7168e', class: \"modal\" }, h(\"h3\", { key: 'c3426d43cb93374db943952d7e21ecc7ed49c6ad' }, this.t('audio_playback.title')), h(\"p\", { key: '46e1b0443fec08430c1d08556a528e2de7419708' }, this.t('audio_playback.description')), h(\"dyte-button\", { key: '99173304cfa04af361162d78993c0ccb06de3400', kind: \"wide\", onClick: () => {\n                this.audio.play();\n                this.onDyteDialogClose();\n            }, title: this.t('audio_playback') }, this.t('audio_playback')))))));\n    }\n    static get watchers() { return {\n        \"meeting\": [\"meetingChanged\"]\n    }; }\n};\n__decorate([\n    SyncWithStore()\n], DyteParticipantsAudio.prototype, \"meeting\", void 0);\n__decorate([\n    SyncWithStore()\n], DyteParticipantsAudio.prototype, \"iconPack\", void 0);\n__decorate([\n    SyncWithStore()\n], DyteParticipantsAudio.prototype, \"t\", void 0);\nDyteParticipantsAudio.style = DyteParticipantsAudioStyle0;\n\nexport { DyteParticipantsAudio as dyte_participants_audio };\n"],
  "mappings": "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",
  "names": []
}
