import {
  SyncWithStore
} from "./chunk-PQDXOFV7.js";
import {
  Host,
  createEvent,
  defaultIconPack,
  h,
  isLiveStreamHost,
  registerInstance,
  useLanguage
} from "./chunk-HB73EBAH.js";
import "./chunk-HFNDKYVF.js";

// node_modules/@dytesdk/ui-kit/dist/esm/dyte-livestream-toggle.entry.js
var dyteLivestreamToggleCss = ":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block}:host([data-hidden]){display:none}";
var DyteLivestreamToggleStyle0 = dyteLivestreamToggleCss;
var __decorate = function(decorators, target, key, desc) {
  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
    r = Reflect.decorate(decorators, target, key, desc);
  else
    for (var i = decorators.length - 1; i >= 0; i--)
      if (d = decorators[i])
        r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var DyteLivestreamToggle = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
    this.stateUpdate = createEvent(this, "dyteStateUpdate", 7);
    this.dyteAPIError = createEvent(this, "dyteAPIError", 7);
    this.variant = "button";
    this.iconPack = defaultIconPack;
    this.t = useLanguage();
    this.livestreamState = "IDLE";
    this.livestreamStateListener = (state) => {
      this.livestreamState = state;
      if (state === "LIVESTREAMING" || state === "IDLE") {
        this.stateUpdate.emit({ activeMoreMenu: false });
      }
    };
    this.isLoading = () => {
      return this.meeting == null || this.livestreamState === "STARTING" || this.livestreamState === "STOPPING";
    };
  }
  connectedCallback() {
    this.meetingChanged(this.meeting);
  }
  disconnectedCallback() {
    this.clearListeners();
  }
  meetingChanged(meeting) {
    var _a, _b;
    if (meeting == null)
      return;
    this.livestreamState = (_a = this.meeting.livestream) === null || _a === void 0 ? void 0 : _a.state;
    (_b = this.meeting.livestream) === null || _b === void 0 ? void 0 : _b.on("livestreamUpdate", this.livestreamStateListener);
  }
  async toggleLivestream() {
    var _a, _b;
    if (this.livestreamState === "LIVESTREAMING") {
      try {
        await ((_a = this.meeting.livestream) === null || _a === void 0 ? void 0 : _a.stop());
      } catch (_c) {
        this.dyteAPIError.emit({
          trace: this.t("livestream.stop"),
          message: this.t("livestream.error.stop")
        });
      }
    } else {
      try {
        await ((_b = this.meeting.livestream) === null || _b === void 0 ? void 0 : _b.start());
      } catch (_d) {
        this.dyteAPIError.emit({
          trace: this.t("livestream.start"),
          message: this.t("livestream.error.start")
        });
      }
    }
  }
  clearListeners() {
    var _a;
    (_a = this.meeting.livestream) === null || _a === void 0 ? void 0 : _a.removeListener("livestreamUpdate", this.livestreamStateListener);
  }
  getLivestreamLabel() {
    switch (this.livestreamState) {
      case "IDLE":
        return this.t("livestream.go_live");
      case "LIVESTREAMING":
        return this.t("livestream.end_live");
      case "WAITING_ON_MANUAL_INGESTION":
        return this.t("livestream.waiting_on_manual_ingestion");
      case "STARTING":
        return this.t("livestream.starting");
      case "STOPPING":
        return this.t("livestream.stopping");
      default:
        return this.t("livestream.error");
    }
  }
  getLivestreamIcon() {
    switch (this.livestreamState) {
      case "IDLE":
        return this.iconPack.start_livestream;
      case "LIVESTREAMING":
        return this.iconPack.stop_livestream;
      case "WAITING_ON_MANUAL_INGESTION":
        return this.iconPack.start_livestream;
      case "STARTING":
      case "STOPPING":
      default:
        return this.iconPack.stop_livestream;
    }
  }
  render() {
    if (!isLiveStreamHost(this.meeting))
      return h(Host, { "data-hidden": true });
    return h(Host, null, h("dyte-controlbar-button", { part: "controlbar-button", size: this.size, iconPack: this.iconPack, isLoading: this.isLoading(), class: { "active-livestream": this.livestreamState === "LIVESTREAMING" }, onClick: () => this.toggleLivestream(), icon: this.getLivestreamIcon(), disabled: this.isLoading(), label: this.t(this.getLivestreamLabel()), variant: this.variant }));
  }
  static get watchers() {
    return {
      "meeting": ["meetingChanged"]
    };
  }
};
__decorate([
  SyncWithStore()
], DyteLivestreamToggle.prototype, "meeting", void 0);
__decorate([
  SyncWithStore()
], DyteLivestreamToggle.prototype, "size", void 0);
__decorate([
  SyncWithStore()
], DyteLivestreamToggle.prototype, "iconPack", void 0);
__decorate([
  SyncWithStore()
], DyteLivestreamToggle.prototype, "t", void 0);
DyteLivestreamToggle.style = DyteLivestreamToggleStyle0;
export {
  DyteLivestreamToggle as dyte_livestream_toggle
};
//# sourceMappingURL=dyte-livestream-toggle.entry-RS2VJY7T.js.map
