"use strict";var C=Object.defineProperty;var w=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>(w(t,typeof e!="symbol"?e+"":e,n),n);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var a=require("react"),S=require("@dytesdk/web-core");function D(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var b=D(a),M=D(S);class E{constructor(e){v(this,"meeting");v(this,"l");v(this,"onUpdate",()=>{this.l.forEach(e=>{e()})});var n,r,d,s,i,o,c,u,h,m,g,p,l,f,L,y;this.meeting=e,this.l=new Set,(n=this.meeting.self)==null||n.addListener("*",this.onUpdate),(r=this.meeting.meta)==null||r.addListener("*",this.onUpdate),(d=this.meeting.participants)==null||d.addListener("*",this.onUpdate),(i=(s=this.meeting.participants)==null?void 0:s.joined)==null||i.addListener("*",this.onUpdate),(c=(o=this.meeting.participants)==null?void 0:o.active)==null||c.addListener("*",this.onUpdate),(h=(u=this.meeting.participants)==null?void 0:u.waitlisted)==null||h.addListener("*",this.onUpdate),(m=this.meeting.stage)==null||m.addListener("*",this.onUpdate),(g=this.meeting.livestream)==null||g.addListener("*",this.onUpdate),(p=this.meeting.chat)==null||p.addListener("*",this.onUpdate),(l=this.meeting.plugins)==null||l.all.addListener("*",this.onUpdate),(f=this.meeting.recording)==null||f.addListener("*",this.onUpdate),(L=this.meeting.connectedMeetings)==null||L.addListener("*",this.onUpdate),(y=this.meeting.polls)==null||y.addListener("*",this.onUpdate)}clean(){var e,n,r,d,s,i,o,c,u,h,m,g,p,l,f,L;(e=this.meeting.self)==null||e.removeListener("*",this.onUpdate),(n=this.meeting.meta)==null||n.removeListener("*",this.onUpdate),(r=this.meeting.participants)==null||r.removeListener("*",this.onUpdate),(s=(d=this.meeting.participants)==null?void 0:d.joined)==null||s.removeListener("*",this.onUpdate),(o=(i=this.meeting.participants)==null?void 0:i.active)==null||o.removeListener("*",this.onUpdate),(u=(c=this.meeting.participants)==null?void 0:c.waitlisted)==null||u.removeListener("*",this.onUpdate),(h=this.meeting.stage)==null||h.removeListener("*",this.onUpdate),(m=this.meeting.livestream)==null||m.removeListener("*",this.onUpdate),(g=this.meeting.chat)==null||g.removeListener("*",this.onUpdate),(p=this.meeting.plugins)==null||p.all.removeListener("*",this.onUpdate),(l=this.meeting.recording)==null||l.removeListener("*",this.onUpdate),(f=this.meeting.connectedMeetings)==null||f.removeListener("*",this.onUpdate),(L=this.meeting.polls)==null||L.removeListener("*",this.onUpdate)}addListener(e){this.l.add(e)}removeListener(e){this.l.delete(e)}}const U=a.createContext({meeting:void 0,updates:void 0});function R({value:t,children:e,fallback:n}){const[r,d]=a.useState(),s=a.useRef();return a.useEffect(()=>(t&&d(new E(t)),()=>{var i;(i=s.current)==null||i.clean()}),[t]),b.default.createElement(U.Provider,{value:{meeting:t,updates:r}},t?e:n)}const _=()=>{const{meeting:t}=a.useContext(U);if(!t)throw new Error("useDyteMeeting must be used within the DyteProvider");return{meeting:t}},j=(t={},e=!1,n=void 0)=>M.default.initMedia(t,e,n),x=t=>{const e=a.useRef(!1),[n,r]=a.useState(),d=t==null?void 0:t.resetOnLeave,s=a.useCallback(async i=>{if(!e.current)return e.current=!0,M.default.init(i).then(o=>(r(o),o)).finally(()=>{e.current=!1})},[]);return a.useEffect(()=>{if(!n||!d)return()=>{};const i=({state:o})=>{o!=="connected-meeting"&&o!=="disconnected"&&r(void 0)};return n.self.on("roomLeft",i),()=>{n.self.removeListener("roomLeft",i)}},[n]),a.useEffect(()=>{if(!n||!n.connectedMeetings)return()=>{};const i=o=>{r(void 0),setTimeout(()=>{r(o)},100)};return n.connectedMeetings.on("meetingChanged",i),()=>{n.connectedMeetings.removeListener("meetingChanged",i)}},[n]),[n,s]},A=(t,e)=>!!(t!==e||Array.isArray(t)&&Array.isArray(e)&&t.length!==e.length),O=t=>{const{meeting:e,updates:n}=a.useContext(U);if(!e)throw new Error("useDyteSelector must be used within the DyteProvider");const r=a.useRef(t(e)),[,d]=a.useReducer(s=>s+1,0);return a.useEffect(()=>{const s=e&&t(e),i=()=>{const o=e&&t(e);A(r.current,o)&&(r.current=o,d())};return s&&typeof s=="object"&&"addListener"in s?(s.addListener("*",d),()=>{s.removeListener("*",d)}):(n==null||n.addListener(i),()=>{n==null||n.removeListener(i)})},[e,n]),r.current};exports.DyteContext=U;exports.DyteProvider=R;exports.initDyteMedia=j;exports.useDyteClient=x;exports.useDyteMeeting=_;exports.useDyteSelector=O;
